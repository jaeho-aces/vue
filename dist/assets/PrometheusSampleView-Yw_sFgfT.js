import{A as C}from"./AreaChart-DTYfb5qn.js";import{d as Y,r as N,a8 as K,m as Z,k as q,l as ee,c as a,b as s,g as _,z as F,t as l,p as V,F as j,s as E,D as te,i as se,o as n,j as oe}from"./index-DUpAoUQv.js";import"./index-C1eOwZ1d.js";const ae={class:"prometheus-sample-view"},ne={class:"header"},re={class:"status-bar"},ie={class:"status-text"},ce={class:"content"},le={class:"tabs"},de={key:0,class:"charts-grid"},ue={class:"chart-card"},me={class:"chart-header"},_e={class:"chart-value"},ve={class:"value-number"},he={class:"chart-container"},pe={class:"chart-card"},fe={class:"chart-header"},ke={class:"chart-value"},ye={class:"value-number"},be={class:"chart-container"},we={class:"chart-card"},ge={class:"chart-header"},Se={class:"chart-value"},Me={class:"value-number"},Te={class:"chart-container"},Fe={class:"chart-card"},xe={class:"chart-header"},De={class:"chart-value"},Ce={class:"value-number"},Ne={class:"chart-container"},Ve={key:1,class:"structured-view"},$e={class:"metrics-grid"},Be={class:"metric-header"},je={class:"metric-name"},Ee={class:"metric-description"},Ae={key:0,class:"metric-results"},Oe={key:0},Pe={key:0,class:"result-labels"},Ue={class:"label-key"},Ie={class:"label-value"},Ke={class:"result-value"},Le={class:"value-number"},Re={class:"value-unit"},Je={key:1,class:"result-timestamp"},Ge={key:1,class:"no-data"},ze={key:1,class:"metric-error-info"},Qe={class:"error-message"},He={key:0,class:"error-type"},We={key:0,class:"empty-state"},Xe={key:2,class:"json-view"},Ye={class:"json-header"},Ze={key:0,class:"update-time"},qe={class:"json-content"},et={key:0,class:"empty-state"},tt=Y({__name:"PrometheusSampleView",setup(st){const k=N(!1),h=N("chart"),y=N(null),$=N([]);let v=null;const r=K({cpu:[],memory:[],networkReceive:[],networkTransmit:[]}),u=K({cpu:0,memory:0,networkReceive:0,networkTransmit:0}),L=async()=>{try{const e=(await se.get("/api/prometheus/initial-data")).data;e.status==="success"&&e.metrics&&R(e.metrics)}catch(t){console.error("초기 데이터 로드 실패:",t)}},R=t=>{var e,o,p,m,f,d,b,w,g,c,T,I;if(((e=t.cpu_usage)==null?void 0:e.status)==="success"&&((p=(o=t.cpu_usage)==null?void 0:o.data)!=null&&p.result)){const i=t.cpu_usage.data.result[0];i!=null&&i.values&&(r.cpu=i.values.map(([S,M])=>{const D=parseFloat(M)||0;return{time:x(S),value:D}}),r.cpu.length>0&&(u.cpu=r.cpu[r.cpu.length-1].value))}if(((m=t.memory_usage)==null?void 0:m.status)==="success"&&((d=(f=t.memory_usage)==null?void 0:f.data)!=null&&d.result)){const i=t.memory_usage.data.result[0];i!=null&&i.values&&(r.memory=i.values.map(([S,M])=>{let D=parseFloat(M)||0;return D=Math.max(0,Math.min(100,D)),{time:x(S),value:D}}),r.memory.length>0&&(u.memory=r.memory[r.memory.length-1].value))}if(((b=t.network_receive)==null?void 0:b.status)==="success"&&((g=(w=t.network_receive)==null?void 0:w.data)!=null&&g.result)){const i=t.network_receive.data.result[0];i!=null&&i.values&&(r.networkReceive=i.values.map(([S,M])=>({time:x(S),value:parseFloat(M)||0})),r.networkReceive.length>0&&(u.networkReceive=r.networkReceive[r.networkReceive.length-1].value))}if(((c=t.network_transmit)==null?void 0:c.status)==="success"&&((I=(T=t.network_transmit)==null?void 0:T.data)!=null&&I.result)){const i=t.network_transmit.data.result[0];i!=null&&i.values&&(r.networkTransmit=i.values.map(([S,M])=>({time:x(S),value:parseFloat(M)||0})),r.networkTransmit.length>0&&(u.networkTransmit=r.networkTransmit[r.networkTransmit.length-1].value))}},J=t=>{if(!t.queries)return;const o=x(new Date().getTime()/1e3),p={'node_cpu_seconds_total{mode="idle"}':"cpu","(node_memory_MemTotal_bytes - node_memory_MemAvailable_bytes) / node_memory_MemTotal_bytes * 100":"memory","rate(node_network_receive_bytes_total[1m])":"networkReceive","rate(node_network_transmit_bytes_total[1m])":"networkTransmit"};Object.entries(t.queries).forEach(([m,f])=>{var b,w;const d=p[m];if(!(!d||f.status!=="success")&&(b=f.data)!=null&&b.result&&f.data.result.length>0){const g=(w=f.data.result[0].value)==null?void 0:w[1];let c=parseFloat(g||"0");(isNaN(c)||!isFinite(c))&&(console.warn(`Invalid value for ${d}:`,g),c=0),d==="memory"&&(c=Math.max(0,Math.min(100,c))),d==="cpu"&&console.log("CPU raw value:",g,"parsed:",c);const T=r[d];T.push({time:o,value:c}),T.length>20&&T.shift(),d==="cpu"?u.cpu=c:d==="memory"?u.memory=c:d==="networkReceive"?u.networkReceive=c:d==="networkTransmit"&&(u.networkTransmit=c)}})},x=t=>new Date(t*1e3).toLocaleTimeString("ko-KR",{hour:"2-digit",minute:"2-digit",second:"2-digit"}),A=t=>t>=1024*1024*1024?`${(t/(1024*1024*1024)).toFixed(2)} GB/s`:t>=1024*1024?`${(t/(1024*1024)).toFixed(2)} MB/s`:t>=1024?`${(t/1024).toFixed(2)} KB/s`:`${t.toFixed(2)} B/s`,O=Z(()=>!y.value||!y.value.queries?{}:y.value.queries),G={'node_cpu_seconds_total{mode="idle"}':"CPU idle 시간 (초)","(node_memory_MemTotal_bytes - node_memory_MemAvailable_bytes) / node_memory_MemTotal_bytes * 100":"Memory 사용률 (%)","rate(node_network_receive_bytes_total[1m])":"Network 수신 속도 (bytes/s)","rate(node_network_transmit_bytes_total[1m])":"Network 송신 속도 (bytes/s)"},z={'node_cpu_seconds_total{mode="idle"}':"CPU Idle 시간","(node_memory_MemTotal_bytes - node_memory_MemAvailable_bytes) / node_memory_MemTotal_bytes * 100":"Memory 사용률","rate(node_network_receive_bytes_total[1m])":"Network 수신","rate(node_network_transmit_bytes_total[1m])":"Network 송신"},Q=t=>G[t]||"프로메테우스 메트릭",H=t=>z[t]||t,W=t=>{if(t==null)return"N/A";const e=typeof t=="string"?parseFloat(t):t;return isNaN(e)?String(t):e>=1e3?e.toLocaleString("ko-KR",{maximumFractionDigits:2}):e.toFixed(2)},X=(t,e)=>{if(e==null)return"";if(t.includes("memory")||t.includes("Mem")){const o=typeof e=="string"?parseFloat(e):e;return o>=1024*1024*1024?`(${(o/(1024*1024*1024)).toFixed(2)} GB)`:o>=1024*1024?`(${(o/(1024*1024)).toFixed(2)} MB)`:o>=1024?`(${(o/1024).toFixed(2)} KB)`:"(bytes)"}if(t.includes("network")||t.includes("receive")||t.includes("transmit")){const o=typeof e=="string"?parseFloat(e):e;return o>=1024*1024*1024?`(${(o/(1024*1024*1024)).toFixed(2)} GB/s)`:o>=1024*1024?`(${(o/(1024*1024)).toFixed(2)} MB/s)`:o>=1024?`(${(o/1024).toFixed(2)} KB/s)`:"(bytes/s)"}return t.includes("cpu")?"(%)":""},P=t=>new Date(t*1e3).toLocaleTimeString("ko-KR",{hour:"2-digit",minute:"2-digit",second:"2-digit",fractionalSecondDigits:3}),U=()=>{v&&B(),v=new EventSource("/api/prometheus/stream"),v.onopen=()=>{k.value=!0,console.log("SSE 연결 성공")},v.onmessage=t=>{try{const e=JSON.parse(t.data);y.value=e,$.value.push({timestamp:e.timestamp||Date.now()/1e3,data:e}),$.value.length>100&&$.value.shift(),e.type!=="connection_info"&&J(e)}catch(e){console.error("데이터 파싱 오류:",e)}},v.onerror=t=>{console.error("SSE 연결 오류:",t),k.value=!1,v&&(v.close(),v=null)}},B=()=>{v&&(v.close(),v=null,k.value=!1,console.log("SSE 연결 종료"))};return q(async()=>{await L(),U()}),ee(()=>{B()}),(t,e)=>(n(),a("div",ae,[s("div",ne,[e[4]||(e[4]=s("h1",{class:"title"},"프로메테우스 모니터링 대시보드",-1)),s("div",re,[s("div",{class:F(["status-indicator",{connected:k.value,disconnected:!k.value}])},[e[3]||(e[3]=s("span",{class:"status-dot"},null,-1)),s("span",ie,l(k.value?"연결됨":"연결 끊김"),1)],2),k.value?_("",!0):(n(),a("button",{key:0,onClick:U,class:"connect-button"}," 재연결 ")),k.value?(n(),a("button",{key:1,onClick:B,class:"disconnect-button"}," 연결 끊기 ")):_("",!0)])]),s("div",ce,[s("div",le,[s("button",{class:F(["tab-button",{active:h.value==="chart"}]),onClick:e[0]||(e[0]=o=>h.value="chart")}," 차트 ",2),s("button",{class:F(["tab-button",{active:h.value==="structured"}]),onClick:e[1]||(e[1]=o=>h.value="structured")}," 구조화 ",2),s("button",{class:F(["tab-button",{active:h.value==="json"}]),onClick:e[2]||(e[2]=o=>h.value="json")}," JSON ",2)]),h.value==="chart"?(n(),a("div",de,[s("div",ue,[s("div",me,[e[5]||(e[5]=s("h3",null,"CPU Idle 시간",-1)),s("div",_e,[s("span",ve,l(u.cpu.toFixed(2))+"초",1)])]),s("div",he,[V(C,{data:r.cpu,color:"#3b82f6",label:"CPU Idle 시간 (초)"},null,8,["data"])])]),s("div",pe,[s("div",fe,[e[6]||(e[6]=s("h3",null,"Memory 사용률",-1)),s("div",ke,[s("span",ye,l(Math.max(0,Math.min(100,u.memory)).toFixed(1))+"%",1)])]),s("div",be,[V(C,{data:r.memory,color:"#10b981",label:"Memory 사용률 (%)",min:0,max:100},null,8,["data"])])]),s("div",we,[s("div",ge,[e[7]||(e[7]=s("h3",null,"Network 수신",-1)),s("div",Se,[s("span",Me,l(A(u.networkReceive)),1)])]),s("div",Te,[V(C,{data:r.networkReceive,color:"#f59e0b",label:"수신 속도 (bytes/s)"},null,8,["data"])])]),s("div",Fe,[s("div",xe,[e[8]||(e[8]=s("h3",null,"Network 송신",-1)),s("div",De,[s("span",Ce,l(A(u.networkTransmit)),1)])]),s("div",Ne,[V(C,{data:r.networkTransmit,color:"#ef4444",label:"송신 속도 (bytes/s)"},null,8,["data"])])])])):_("",!0),h.value==="structured"?(n(),a("div",Ve,[s("div",$e,[(n(!0),a(j,null,E(O.value,(o,p)=>(n(),a("div",{key:p,class:F(["metric-card",{"metric-error":o.status==="error"}])},[s("div",Be,[s("h3",je,l(H(String(p))),1),s("span",{class:F(["metric-status",o.status==="success"?"status-success":"status-error"])},l(o.status==="success"?"정상":"오류"),3)]),s("div",Ee,l(Q(String(p))),1),o.status==="success"&&o.data?(n(),a("div",Ae,[o.data.result&&o.data.result.length>0?(n(),a("div",Oe,[(n(!0),a(j,null,E(o.data.result,(m,f)=>{var d,b,w;return n(),a("div",{key:f,class:"result-item"},[m.metric&&Object.keys(m.metric).length>0?(n(),a("div",Pe,[(n(!0),a(j,null,E(m.metric,(g,c)=>(n(),a("div",{key:c,class:"label-item"},[s("span",Ue,l(c)+":",1),s("span",Ie,l(g),1)]))),128))])):_("",!0),s("div",Ke,[e[9]||(e[9]=s("span",{class:"value-label"},"값:",-1)),s("span",Le,l(W((d=m.value)==null?void 0:d[1])),1),s("span",Re,l(X(String(p),(b=m.value)==null?void 0:b[1])),1)]),(w=m.value)!=null&&w[0]?(n(),a("div",Je," 타임스탬프: "+l(P(m.value[0])),1)):_("",!0)])}),128))])):(n(),a("div",Ge," 데이터 없음 (메트릭이 수집되지 않음) "))])):o.status==="error"?(n(),a("div",ze,[s("div",Qe,[e[10]||(e[10]=s("strong",null,"오류:",-1)),te(" "+l(o.error||"알 수 없는 오류"),1)]),o.errorType?(n(),a("div",He," 오류 타입: "+l(o.errorType),1)):_("",!0)])):_("",!0)],2))),128)),Object.keys(O.value).length===0?(n(),a("div",We," 데이터가 없습니다. SSE 연결을 확인하세요. ")):_("",!0)])])):_("",!0),h.value==="json"?(n(),a("div",Xe,[s("div",Ye,[e[11]||(e[11]=s("h3",null,"원본 JSON 데이터",-1)),y.value?(n(),a("span",Ze," 마지막 업데이트: "+l(P(y.value.timestamp)),1)):_("",!0)]),s("div",qe,[s("pre",null,l(JSON.stringify(y.value,null,2)),1),y.value?_("",!0):(n(),a("div",et," 데이터가 없습니다. SSE 연결을 확인하세요. "))])])):_("",!0)])]))}}),rt=oe(tt,[["__scopeId","data-v-e3fd9ca1"]]);export{rt as default};
