import{A as j}from"./AreaChart-CsNxNoRO.js";import{d as Y,r as C,a9 as I,m as Z,k as q,l as ee,c as r,b as s,g as x,z as T,t as d,p as N,F as V,s as E,D as te,i as se,o as n}from"./index-CGZOc8ps.js";import"./index-DaD0tBQ8.js";const oe={class:"flex flex-col h-full overflow-hidden"},re={class:"flex justify-between items-center py-5 border-b border-gray-200 mb-5"},ne={class:"flex items-center gap-3"},ae={class:"flex-1 flex flex-col overflow-hidden gap-5"},ie={class:"flex gap-2 border-b border-gray-200"},le={key:0,class:"grid grid-cols-2 gap-5 flex-1 min-h-0"},de={class:"bg-white border border-gray-200 rounded-lg p-5 flex flex-col min-h-0"},ce={class:"flex justify-between items-center mb-4"},me={class:"flex items-baseline gap-1"},ue={class:"text-xl font-bold text-gray-900 font-mono"},xe={class:"flex-1 min-h-[200px] relative"},fe={class:"bg-white border border-gray-200 rounded-lg p-5 flex flex-col min-h-0"},be={class:"flex justify-between items-center mb-4"},pe={class:"flex items-baseline gap-1"},_e={class:"text-xl font-bold text-gray-900 font-mono"},ge={class:"flex-1 min-h-[200px] relative"},ye={class:"bg-white border border-gray-200 rounded-lg p-5 flex flex-col min-h-0"},ve={class:"flex justify-between items-center mb-4"},he={class:"flex items-baseline gap-1"},we={class:"text-xl font-bold text-gray-900 font-mono"},ke={class:"flex-1 min-h-[200px] relative"},Se={class:"bg-white border border-gray-200 rounded-lg p-5 flex flex-col min-h-0"},Me={class:"flex justify-between items-center mb-4"},Te={class:"flex items-baseline gap-1"},Fe={class:"text-xl font-bold text-gray-900 font-mono"},De={class:"flex-1 min-h-[200px] relative"},je={key:1,class:"flex-1 overflow-hidden flex flex-col"},Ce={class:"flex-1 overflow-y-auto p-5 grid gap-5 prometheus-metrics-grid",style:{"grid-template-columns":"repeat(auto-fill, minmax(400px, 1fr))"}},Ne={class:"flex justify-between items-center mb-3"},$e={class:"text-base font-semibold text-gray-900 m-0"},Be={class:"text-[13px] text-gray-500 mb-4 leading-relaxed"},Ve={key:0,class:"mt-3"},Ee={key:0},Ae={key:0,class:"mb-2 pb-2 border-b border-gray-200"},Oe={class:"font-semibold text-gray-500 min-w-[100px]"},Ue={class:"text-gray-900 font-mono"},Ke={class:"flex items-baseline gap-2 mb-2"},Pe={class:"text-lg font-bold text-gray-900 font-mono"},Ie={class:"text-xs text-gray-500"},Le={key:1,class:"text-[11px] text-gray-500 mt-1"},Re={key:1,class:"p-3 bg-amber-100 rounded-md text-amber-800 text-[13px] text-center"},Je={key:1,class:"p-3 bg-red-100 rounded-md"},Ge={class:"text-red-800 text-[13px] mb-2"},ze={key:0,class:"text-[11px] text-red-700 italic"},Qe={key:0,class:"flex items-center justify-center h-full text-gray-500 text-sm"},He={key:2,class:"flex-1 flex flex-col overflow-hidden bg-gray-50 rounded-lg p-5"},We={class:"flex justify-between items-center mb-4"},Xe={key:0,class:"text-sm text-gray-500"},Ye={class:"flex-1 overflow-y-auto bg-white rounded p-4 prometheus-json-content"},Ze={class:"m-0 text-xs font-mono text-gray-900 whitespace-pre-wrap break-words"},qe={key:0,class:"flex items-center justify-center h-full text-gray-500 text-sm"},rt=Y({__name:"PrometheusSampleView",setup(et){const w=C(!1),b=C("chart"),g=C(null),$=C([]);let f=null;const a=I({cpu:[],memory:[],networkReceive:[],networkTransmit:[]}),m=I({cpu:0,memory:0,networkReceive:0,networkTransmit:0}),L=async()=>{try{const e=(await se.get("/api/prometheus/initial-data")).data;e.status==="success"&&e.metrics&&R(e.metrics)}catch(t){console.error("초기 데이터 로드 실패:",t)}},R=t=>{var e,o,p,u,_,c,y,v,h,l,M,P;if(((e=t.cpu_usage)==null?void 0:e.status)==="success"&&((p=(o=t.cpu_usage)==null?void 0:o.data)!=null&&p.result)){const i=t.cpu_usage.data.result[0];i!=null&&i.values&&(a.cpu=i.values.map(([k,S])=>{const D=parseFloat(S)||0;return{time:F(k),value:D}}),a.cpu.length>0&&(m.cpu=a.cpu[a.cpu.length-1].value))}if(((u=t.memory_usage)==null?void 0:u.status)==="success"&&((c=(_=t.memory_usage)==null?void 0:_.data)!=null&&c.result)){const i=t.memory_usage.data.result[0];i!=null&&i.values&&(a.memory=i.values.map(([k,S])=>{let D=parseFloat(S)||0;return D=Math.max(0,Math.min(100,D)),{time:F(k),value:D}}),a.memory.length>0&&(m.memory=a.memory[a.memory.length-1].value))}if(((y=t.network_receive)==null?void 0:y.status)==="success"&&((h=(v=t.network_receive)==null?void 0:v.data)!=null&&h.result)){const i=t.network_receive.data.result[0];i!=null&&i.values&&(a.networkReceive=i.values.map(([k,S])=>({time:F(k),value:parseFloat(S)||0})),a.networkReceive.length>0&&(m.networkReceive=a.networkReceive[a.networkReceive.length-1].value))}if(((l=t.network_transmit)==null?void 0:l.status)==="success"&&((P=(M=t.network_transmit)==null?void 0:M.data)!=null&&P.result)){const i=t.network_transmit.data.result[0];i!=null&&i.values&&(a.networkTransmit=i.values.map(([k,S])=>({time:F(k),value:parseFloat(S)||0})),a.networkTransmit.length>0&&(m.networkTransmit=a.networkTransmit[a.networkTransmit.length-1].value))}},J=t=>{if(!t.queries)return;const o=F(new Date().getTime()/1e3),p={'node_cpu_seconds_total{mode="idle"}':"cpu","(node_memory_MemTotal_bytes - node_memory_MemAvailable_bytes) / node_memory_MemTotal_bytes * 100":"memory","rate(node_network_receive_bytes_total[1m])":"networkReceive","rate(node_network_transmit_bytes_total[1m])":"networkTransmit"};Object.entries(t.queries).forEach(([u,_])=>{var y,v;const c=p[u];if(!(!c||_.status!=="success")&&(y=_.data)!=null&&y.result&&_.data.result.length>0){const h=(v=_.data.result[0].value)==null?void 0:v[1];let l=parseFloat(h||"0");(isNaN(l)||!isFinite(l))&&(console.warn(`Invalid value for ${c}:`,h),l=0),c==="memory"&&(l=Math.max(0,Math.min(100,l))),c==="cpu"&&console.log("CPU raw value:",h,"parsed:",l);const M=a[c];M.push({time:o,value:l}),M.length>20&&M.shift(),c==="cpu"?m.cpu=l:c==="memory"?m.memory=l:c==="networkReceive"?m.networkReceive=l:c==="networkTransmit"&&(m.networkTransmit=l)}})},F=t=>new Date(t*1e3).toLocaleTimeString("ko-KR",{hour:"2-digit",minute:"2-digit",second:"2-digit"}),A=t=>t>=1024*1024*1024?`${(t/(1024*1024*1024)).toFixed(2)} GB/s`:t>=1024*1024?`${(t/(1024*1024)).toFixed(2)} MB/s`:t>=1024?`${(t/1024).toFixed(2)} KB/s`:`${t.toFixed(2)} B/s`,O=Z(()=>!g.value||!g.value.queries?{}:g.value.queries),G={'node_cpu_seconds_total{mode="idle"}':"CPU idle 시간 (초)","(node_memory_MemTotal_bytes - node_memory_MemAvailable_bytes) / node_memory_MemTotal_bytes * 100":"Memory 사용률 (%)","rate(node_network_receive_bytes_total[1m])":"Network 수신 속도 (bytes/s)","rate(node_network_transmit_bytes_total[1m])":"Network 송신 속도 (bytes/s)"},z={'node_cpu_seconds_total{mode="idle"}':"CPU Idle 시간","(node_memory_MemTotal_bytes - node_memory_MemAvailable_bytes) / node_memory_MemTotal_bytes * 100":"Memory 사용률","rate(node_network_receive_bytes_total[1m])":"Network 수신","rate(node_network_transmit_bytes_total[1m])":"Network 송신"},Q=t=>G[t]||"프로메테우스 메트릭",H=t=>z[t]||t,W=t=>{if(t==null)return"N/A";const e=typeof t=="string"?parseFloat(t):t;return isNaN(e)?String(t):e>=1e3?e.toLocaleString("ko-KR",{maximumFractionDigits:2}):e.toFixed(2)},X=(t,e)=>{if(e==null)return"";if(t.includes("memory")||t.includes("Mem")){const o=typeof e=="string"?parseFloat(e):e;return o>=1024*1024*1024?`(${(o/(1024*1024*1024)).toFixed(2)} GB)`:o>=1024*1024?`(${(o/(1024*1024)).toFixed(2)} MB)`:o>=1024?`(${(o/1024).toFixed(2)} KB)`:"(bytes)"}if(t.includes("network")||t.includes("receive")||t.includes("transmit")){const o=typeof e=="string"?parseFloat(e):e;return o>=1024*1024*1024?`(${(o/(1024*1024*1024)).toFixed(2)} GB/s)`:o>=1024*1024?`(${(o/(1024*1024)).toFixed(2)} MB/s)`:o>=1024?`(${(o/1024).toFixed(2)} KB/s)`:"(bytes/s)"}return t.includes("cpu")?"(%)":""},U=t=>new Date(t*1e3).toLocaleTimeString("ko-KR",{hour:"2-digit",minute:"2-digit",second:"2-digit",fractionalSecondDigits:3}),K=()=>{f&&B(),f=new EventSource("/api/prometheus/stream"),f.onopen=()=>{w.value=!0,console.log("SSE 연결 성공")},f.onmessage=t=>{try{const e=JSON.parse(t.data);g.value=e,$.value.push({timestamp:e.timestamp||Date.now()/1e3,data:e}),$.value.length>100&&$.value.shift(),e.type!=="connection_info"&&J(e)}catch(e){console.error("데이터 파싱 오류:",e)}},f.onerror=t=>{console.error("SSE 연결 오류:",t),w.value=!1,f&&(f.close(),f=null)}},B=()=>{f&&(f.close(),f=null,w.value=!1,console.log("SSE 연결 종료"))};return q(async()=>{await L(),K()}),ee(()=>{B()}),(t,e)=>(n(),r("div",oe,[s("div",re,[e[4]||(e[4]=s("h1",{class:"text-2xl font-semibold text-gray-900 m-0"},"프로메테우스 모니터링 대시보드",-1)),s("div",ne,[s("div",{class:T(["flex items-center gap-2 px-3 py-2 rounded-md text-sm",w.value?"bg-emerald-100 text-emerald-800":"bg-red-100 text-red-800"])},[e[3]||(e[3]=s("span",{class:"prometheus-status-dot"},null,-1)),s("span",null,d(w.value?"연결됨":"연결 끊김"),1)],2),w.value?x("",!0):(n(),r("button",{key:0,onClick:K,class:"px-4 py-2 rounded-md text-sm font-medium cursor-pointer transition bg-blue-500 text-white hover:bg-blue-600"}," 재연결 ")),w.value?(n(),r("button",{key:1,onClick:B,class:"px-4 py-2 rounded-md text-sm font-medium cursor-pointer transition bg-red-500 text-white hover:bg-red-600"}," 연결 끊기 ")):x("",!0)])]),s("div",ae,[s("div",ie,[s("button",{class:T(["py-3 px-6 border-none bg-transparent text-sm font-medium cursor-pointer border-b-2 -mb-px transition",b.value==="chart"?"text-gray-900 border-blue-500 font-semibold":"text-gray-500 border-transparent hover:text-gray-900 hover:bg-gray-100"]),onClick:e[0]||(e[0]=o=>b.value="chart")}," 차트 ",2),s("button",{class:T(["py-3 px-6 border-none bg-transparent text-sm font-medium cursor-pointer border-b-2 -mb-px transition",b.value==="structured"?"text-gray-900 border-blue-500 font-semibold":"text-gray-500 border-transparent hover:text-gray-900 hover:bg-gray-100"]),onClick:e[1]||(e[1]=o=>b.value="structured")}," 구조화 ",2),s("button",{class:T(["py-3 px-6 border-none bg-transparent text-sm font-medium cursor-pointer border-b-2 -mb-px transition",b.value==="json"?"text-gray-900 border-blue-500 font-semibold":"text-gray-500 border-transparent hover:text-gray-900 hover:bg-gray-100"]),onClick:e[2]||(e[2]=o=>b.value="json")}," JSON ",2)]),b.value==="chart"?(n(),r("div",le,[s("div",de,[s("div",ce,[e[5]||(e[5]=s("h3",{class:"text-base font-semibold text-gray-900 m-0"},"CPU Idle 시간",-1)),s("div",me,[s("span",ue,d(m.cpu.toFixed(2))+"초",1)])]),s("div",xe,[N(j,{data:a.cpu,color:"#3b82f6",label:"CPU Idle 시간 (초)"},null,8,["data"])])]),s("div",fe,[s("div",be,[e[6]||(e[6]=s("h3",{class:"text-base font-semibold text-gray-900 m-0"},"Memory 사용률",-1)),s("div",pe,[s("span",_e,d(Math.max(0,Math.min(100,m.memory)).toFixed(1))+"%",1)])]),s("div",ge,[N(j,{data:a.memory,color:"#10b981",label:"Memory 사용률 (%)",min:0,max:100},null,8,["data"])])]),s("div",ye,[s("div",ve,[e[7]||(e[7]=s("h3",{class:"text-base font-semibold text-gray-900 m-0"},"Network 수신",-1)),s("div",he,[s("span",we,d(A(m.networkReceive)),1)])]),s("div",ke,[N(j,{data:a.networkReceive,color:"#f59e0b",label:"수신 속도 (bytes/s)"},null,8,["data"])])]),s("div",Se,[s("div",Me,[e[8]||(e[8]=s("h3",{class:"text-base font-semibold text-gray-900 m-0"},"Network 송신",-1)),s("div",Te,[s("span",Fe,d(A(m.networkTransmit)),1)])]),s("div",De,[N(j,{data:a.networkTransmit,color:"#ef4444",label:"송신 속도 (bytes/s)"},null,8,["data"])])])])):x("",!0),b.value==="structured"?(n(),r("div",je,[s("div",Ce,[(n(!0),r(V,null,E(O.value,(o,p)=>(n(),r("div",{key:p,class:T(["bg-white border rounded-lg p-5 transition hover:shadow-md",o.status==="error"?"border-red-500 bg-red-50":"border-gray-200"])},[s("div",Ne,[s("h3",$e,d(H(String(p))),1),s("span",{class:T(["px-2 py-1 rounded text-xs font-medium",o.status==="success"?"bg-emerald-100 text-emerald-800":"bg-red-100 text-red-800"])},d(o.status==="success"?"정상":"오류"),3)]),s("div",Be,d(Q(String(p))),1),o.status==="success"&&o.data?(n(),r("div",Ve,[o.data.result&&o.data.result.length>0?(n(),r("div",Ee,[(n(!0),r(V,null,E(o.data.result,(u,_)=>{var c,y,v;return n(),r("div",{key:_,class:"p-3 bg-gray-50 rounded-md mb-3 last:mb-0"},[u.metric&&Object.keys(u.metric).length>0?(n(),r("div",Ae,[(n(!0),r(V,null,E(u.metric,(h,l)=>(n(),r("div",{key:l,class:"flex gap-2 mb-1 text-xs"},[s("span",Oe,d(l)+":",1),s("span",Ue,d(h),1)]))),128))])):x("",!0),s("div",Ke,[e[9]||(e[9]=s("span",{class:"text-[13px] font-semibold text-gray-500"},"값:",-1)),s("span",Pe,d(W((c=u.value)==null?void 0:c[1])),1),s("span",Ie,d(X(String(p),(y=u.value)==null?void 0:y[1])),1)]),(v=u.value)!=null&&v[0]?(n(),r("div",Le," 타임스탬프: "+d(U(u.value[0])),1)):x("",!0)])}),128))])):(n(),r("div",Re," 데이터 없음 (메트릭이 수집되지 않음) "))])):o.status==="error"?(n(),r("div",Je,[s("div",Ge,[e[10]||(e[10]=s("strong",null,"오류:",-1)),te(" "+d(o.error||"알 수 없는 오류"),1)]),o.errorType?(n(),r("div",ze," 오류 타입: "+d(o.errorType),1)):x("",!0)])):x("",!0)],2))),128)),Object.keys(O.value).length===0?(n(),r("div",Qe," 데이터가 없습니다. SSE 연결을 확인하세요. ")):x("",!0)])])):x("",!0),b.value==="json"?(n(),r("div",He,[s("div",We,[e[11]||(e[11]=s("h3",{class:"text-base font-semibold text-gray-900 m-0"},"원본 JSON 데이터",-1)),g.value?(n(),r("span",Xe," 마지막 업데이트: "+d(U(g.value.timestamp)),1)):x("",!0)]),s("div",Ye,[s("pre",Ze,d(JSON.stringify(g.value,null,2)),1),g.value?x("",!0):(n(),r("div",qe," 데이터가 없습니다. SSE 연결을 확인하세요. "))])])):x("",!0)])]))}});export{rt as default};
